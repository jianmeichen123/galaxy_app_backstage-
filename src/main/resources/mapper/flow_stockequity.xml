<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper  
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.galaxy.im.business.flow.stockequity.dao.IStockequityDao">

	<!-- 获取项目的所有上传文件的的状态和个数 -->
	<select id="operateStatus" parameterType="hashmap" resultType="hashmap">
		select 
			case isnull(d1.dict_code) when 1 then 'no' else d1.dict_code end dictCode,
			count(1) pcount
		from sop_project p
		left join sop_file f on p.id=f.project_id
		left join dict d1 on f.file_worktype=d1.dict_code
		where p.id=#{projectId} and f.file_status in ('fileStatus:2','fileStatus:4')
		group by d1.dict_code;
	</select>
	
	<!-- 进入到下一个流程阶段 -非绿色通道 -->
	<update id="enterNextFlow" parameterType="hashmap">
		update sop_project p
			set p.project_progress=#{projectProgress},
			p.project_status=#{projectStatus}
			where p.id=#{projectId};
	</update>
	
	<!-- 获取资金拨付代办任务的状态-->
	<select id="status"  parameterType="hashmap" resultType="hashmap">
		SELECT task_status tstatus  FROM sop_task WHERE project_id=#{projectId} AND task_name='上传资金拨付凭证';

	</select>

</mapper>