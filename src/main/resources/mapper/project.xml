<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper  
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.galaxy.im.bean.project.ProjectBo">

  	<sql id="Base_Where_Clause">
		<where>
			<trim prefixOverrides="and">
			    <if test="id != null"> and id =#{id}</if>
				<if test="createUid != null" > and create_uid = #{createUid} </if>
				<if test="projectDepartid != null" > and project_departId = #{projectDepartid} </if>
				<if test="projectStatus != null" > and project_status = #{projectStatus} </if>
				<if test="projectType != null" > and project_type = #{projectType} </if>	
				<if test="projectProgress != null" > and project_progress = #{projectProgress} </if>
				<if test="financeStatus != null" > and finance_status = #{financeStatus} </if>
				<if test="faFlag != null"> and fa_flag = #{faFlag} </if>
			</trim>
		</where>
		<if test="sorting != null">order by ${sorting}</if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>
	</sql>
	
  	<sql id="Base_Column_List" >
	    id, 
	    project_name projectName,
	    project_code projectCode, 
	    project_type projectType, 
	    stock_transfer stockTransfer, 
	    project_careerline projectCareerline, 
	    project_departId projectDepartId,
	    industry_own industryOwn, 
	    project_valuations projectValuations, 
	    final_valuations finalValuations, 
	    currency_unit currencyUnit,
	    service_charge serviceCharge,
	    project_company projectCompany, 
	    formation_date formationDate, 
	    project_company_code projectCompanyCode, 
	    company_legal companyLegal, 
	    create_uid createUid, 
	    create_uname createUname, 
	    create_uposition createUposition, 
	    project_progress projectProgress, 
	    project_status projectStatus, 
	    updated_time updatedTime, 
	    created_time createdTime,
	    project_describe projectDescribe, 
	    project_describe_financing projectDescribeFinancing, 
	    project_business_model projectBusinessModel, 
	    company_location companyLocation, 
	    user_portrait userPortrait,
	    prospect_analysis prospectAnalysis, 
	    next_financing_source nextFinancingSource,
	    industry_analysis industryAnalysis,
	    operational_data operationalData, 
	    idea_id ideaId, 
	    fa_flag faFlag, 
	    fa_name faName,
	    project_time projectTime,
	    tt_finance_status financeStatus,
		tt_finance_status_code financeStatusCode,
		tt_final_contribution finalContribution, 		
		tt_final_share_ratio finalShareRatio, 				
		tt_project_contribution projectContribution,  
		tt_project_share_ratio projectShareRatio	
   </sql>
   
	<!-- 查询 项目列表 变化 跟进中的时候 -->
	<select id="selectBygjz" resultType="hashMap" parameterType="java.util.Map">
		select 
		<include refid="Base_Column_List" />
		from sop_project  
		where  
			project_progress &lt;&gt; 'projectProgress:10'
			and project_status = "projectStatus:0" 	 
		<if test="projectType != null" > and project_type = #{projectType} </if>	
		<if test="createUid != null" > and create_uid = #{createUid} </if>
		<if test="projectCareerline != null" > and project_careerline = #{projectCareerline} </if>
		<if test="projectDepartid != null" > and project_departId = #{projectDepartid} </if>
		<if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
			  </if>
		<if test="projectProgress != null" > and project_progress = #{projectProgress} </if>
		<if test="financeStatus != null" > and finance_status = #{financeStatus} </if>
		<if test="faFlag != null"> and fa_flag = #{faFlag} </if>
		<if test="sorting != null">order by ${sorting}</if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>				
	</select>
	
	<!-- 查询 项目列表中的数目 变化 跟进中的时候 -->
	<select id="selectBygjzCount" resultType="java.lang.Long" parameterType="java.util.Map">
		select count(id) from sop_project  
		where  
			project_progress &lt;&gt; 'projectProgress:10'
			and project_status = "projectStatus:0"		 
		<if test="projectType != null" > and project_type = #{projectType} </if>	
		<if test="projectProgress != null" > and project_progress = #{projectProgress} </if>
	    <if test="createUid != null" > and create_uid = #{createUid} </if>
		<if test="projectCareerline != null" > and project_careerline = #{projectCareerline} </if>
		<if test="projectDepartid != null" > and project_departId = #{projectDepartid} </if>
		<if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
			  </if>
		<if test="financeStatus != null" > and finance_status = #{financeStatus} </if>	
		<if test="faFlag != null"> and fa_flag = #{faFlag} </if>			
	</select>
	
	<!-- 查询 项目列表 变化 投后运营的时候 -->
	<select id="selectByth" resultType="hashMap" parameterType="java.util.Map">
		select 
			<include refid="Base_Column_List" />
		from sop_project  where  		 
		project_status = "projectStatus:1"
		<if test="projectType != null" > and project_type = #{projectType} </if>	
		<if test="projectProgress != null" > and project_progress = #{projectProgress} </if>		
	    <if test="createUid != null" > and create_uid = #{createUid} </if>
		<if test="projectCareerline != null" > and project_careerline = #{projectCareerline} </if>
		<if test="projectDepartid != null" > and project_departId = #{projectDepartid} </if>
		<if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
			  </if>
		<if test="financeStatus != null" > and finance_status = #{financeStatus} </if>	
		<if test="faFlag != null"> and fa_flag = #{faFlag} </if>
		<if test="sorting != null">order by ${sorting}</if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>			
	</select>
	
	<!-- 查询 项目列表中的数目 变化 投后运营的时候 -->
	<select id="selectBythCount" resultType="java.lang.Long" parameterType="java.util.Map">
		select count(id) from sop_project  where  		 
		 project_status = "projectStatus:1"
		<if test="projectType != null" > and project_type = #{projectType} </if>			
		<if test="projectProgress != null" > and project_progress = #{projectProgress} </if>		
	    <if test="createUid != null" > and create_uid = #{createUid} </if>
		<if test="projectCareerline != null" > and project_careerline = #{projectCareerline} </if>
		<if test="projectDepartid != null" > and project_departId = #{projectDepartid} </if>
		<if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
			  </if>
		<if test="financeStatus != null" > and finance_status = #{financeStatus} </if>	
		<if test="faFlag != null"> and fa_flag = #{faFlag} </if>			
	</select>
	
	<!-- 查询 项目列表 变化 否决的时候 -->
	<select id="selectByfj" resultType="hashMap" parameterType="java.util.Map">
		select 
			<include refid="Base_Column_List" />
		from sop_project  where 		 
		project_status = "projectStatus:2" 
		<if test="projectType != null" > and project_type = #{projectType} </if>	
		<if test="projectProgress != null" > and project_progress = #{projectProgress} </if>
		<if test="financeStatus != null" > and finance_status = #{financeStatus} </if>	
	    <if test="createUid != null" > and create_uid = #{createUid} </if>
		<if test="projectCareerline != null" > and project_careerline = #{projectCareerline} </if>
		<if test="projectDepartid != null" > and project_departId = #{projectDepartid} </if>
		<if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
			  </if>
		<if test="faFlag != null"> and fa_flag = #{faFlag} </if>
		<if test="sorting != null">order by ${sorting}</if>
		<if test="offset != null and limit != null">
			limit #{offset}, #{limit}
		</if>			
	</select>
	
	<!-- 查询 项目列表中的数目 变化 否决的时候 -->
	<select id="selectByfjCount" resultType="java.lang.Long" parameterType="java.util.Map">
		select count(id) from sop_project  where 		 
		  project_status = "projectStatus:2" 
	    <if test="createUid != null" > and create_uid = #{createUid} </if>
		<if test="projectCareerline != null" > and project_careerline = #{projectCareerline} </if>
		<if test="projectDepartid != null" > and project_departId = #{projectDepartid} </if>
		<if test="deptIdList != null">
					AND project_departId IN
					<foreach collection="deptIdList" index="item" item="item" open="("
						separator="," close=")">
						#{item}
					</foreach>
			  </if>
		<if test="projectType != null" > and project_type = #{projectType} </if>	
		<if test="projectProgress != null" > and project_progress = #{projectProgress} </if>
		<if test="financeStatus != null" > and finance_status = #{financeStatus} </if>	
		<if test="faFlag != null"> and fa_flag = #{faFlag} </if>			
	</select>
	
	
	<!-- 查询总数 -->
	<select id="selectPageListCount" resultType="java.lang.Long" parameterType="java.util.Map">
		SELECT count(id) 
		FROM sop_project 
		LEFT JOIN (
				  SELECT r.project_id,
					MAX(CASE t.code WHEN 'FNO1_2' THEN r.content_describe1 ELSE NULL END) tt_project_contribution,
					MAX(CASE t.code WHEN 'FNO1_2_3' THEN r.content_describe1 ELSE NULL END) tt_project_share_ratio,
					MAX(CASE t.code WHEN 'FNO1_3_1' THEN r.content_describe1 ELSE NULL END) tt_final_contribution,
					MAX(CASE t.code WHEN 'FNO1_3_3' THEN r.content_describe1 ELSE NULL END) tt_final_share_ratio,
					MAX(CASE t.code WHEN 'FNO1_1' THEN d.code ELSE NULL END) tt_finance_status_code,
					MAX(CASE t.code WHEN 'FNO1_1' THEN d.name ELSE NULL END) tt_finance_status
					FROM information_title_relate t 
					INNER JOIN information_result r ON t.title_id = r.title_id AND t.report_type=4
					LEFT JOIN information_dictionary d on d.id=r.content_choose
					GROUP BY r.project_id
		) tt  ON tt.project_id = sop_project.id
		<include refid="Base_Where_Clause" />
	</select>

	<!-- 查询 -->
	<select id="selectPageList" resultType="hashMap" parameterType="java.util.Map">
		SELECT 
		<include refid="Base_Column_List" />
		FROM sop_project 
		LEFT JOIN (
				  SELECT r.project_id,
					MAX(CASE t.code WHEN 'FNO1_2' THEN r.content_describe1 ELSE NULL END) tt_project_contribution,
					MAX(CASE t.code WHEN 'FNO1_2_3' THEN r.content_describe1 ELSE NULL END) tt_project_share_ratio,
					MAX(CASE t.code WHEN 'FNO1_3_1' THEN r.content_describe1 ELSE NULL END) tt_final_contribution,
					MAX(CASE t.code WHEN 'FNO1_3_3' THEN r.content_describe1 ELSE NULL END) tt_final_share_ratio,
					MAX(CASE t.code WHEN 'FNO1_1' THEN d.code ELSE NULL END) tt_finance_status_code,
					MAX(CASE t.code WHEN 'FNO1_1' THEN d.name ELSE NULL END) tt_finance_status
					FROM information_title_relate t 
					INNER JOIN information_result r ON t.title_id = r.title_id AND t.report_type=4
					LEFT JOIN information_dictionary d on d.id=r.content_choose
					GROUP BY r.project_id
		) tt  ON tt.project_id = sop_project.id
		<include refid="Base_Where_Clause" />
	</select>
	
</mapper>