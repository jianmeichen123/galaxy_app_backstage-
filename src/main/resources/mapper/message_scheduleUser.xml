<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.galaxy.im.bean.message.ScheduleMessageUserBean">
	
	<sql id="Base_Where_Clause">
		<where>
			<trim prefixOverrides="and">
				<if test="id != null"> and id = #{id ,jdbcType=BIGINT} </if>
				<if test="ids != null">
					and id IN
					<foreach collection="ids" index="atem" item="atem" open="(" separator="," close=")">
						#{atem}
					</foreach>
				</if> 
				<if test="mid != null" > and mid = #{mid ,jdbcType=BIGINT}  </if>
				<if test="mids != null">
					and mid IN
					<foreach collection="mids" index="item" item="item" open="(" separator="," close=")">
						#{item}
					</foreach>
				</if> 
				<if test="uid != null" > and uid = #{uid ,jdbcType=BIGINT}  </if>
				<if test="uname != null" > and uname = #{uname ,jdbcType=VARCHAR}  </if>
				<if test="typeRole != null" > and type_role = #{typeRole ,jdbcType=TINYINT}  </if>
				<if test="isUse != null" > and is_use = #{isUse ,jdbcType=TINYINT}  </if>
				<if test="isSend != null" > and is_send = #{isSend ,jdbcType=TINYINT}  </if>
				<if test="isRead != null" > and is_read = #{isRead ,jdbcType=TINYINT}  </if>
				<if test="isDel != null" > and is_del = #{isDel ,jdbcType=TINYINT}  </if>
				<if test="createdTime != null" > and created_time = #{createdTime ,jdbcType=BIGINT}  </if>
				<if test="updatedTime != null" > and updated_time = #{updatedTime ,jdbcType=BIGINT}  </if>
			</trim>
			<if test="sorting != null">order by ${sorting}</if>
			<if test="offset != null and limit != null">
				limit #{offset}, #{limit}
			</if>
		</where>
	</sql>
	
	<!-- 查询列表 -->
	<select id="selectMuserAndMcontentList" parameterType="hashmap"
		resultType="hashmap">
		select
		mu.id, mu.mid, mu.uid, mu.type_role typeRole, mu.is_read isRead,mu.is_use
		isUse,
		me.type, me.remrk_id remrkId, me.content , me.send_time sendTime
		from
		schedule_message_user mu left join schedule_message me on mu.mid =
		me.id
		<where>
		<if test="userId != null" > mu.uid = #{userId}</if>
		<if test="isUse != null" >and mu.is_use = #{isUse}</if>
		<if test="isDel != null" >and mu.is_del = #{isDel}</if>
		<if test="isRead != null" >and mu.is_read = #{isRead}</if>
		<if test="isSend != null" >and mu.is_send = #{isSend}</if>
		<if test="status != null" >and me.status = #{status}</if>
		</where>
		order by ${property} ${direction}
		limit #{offset},${limit};

	</select>

	<!-- 列表记录个数 -->
	<select id="selectMuserAndMcontentCount" parameterType="hashmap"
		resultType="integer">
		select
		count(mu.id)
		from
		schedule_message_user mu left join schedule_message me on mu.mid = me.id
		<where>
		<if test="userId != null" > mu.uid = #{userId}</if>
		<if test="isUse != null" >and mu.is_use = #{isUse}</if>
		<if test="isDel != null" >and mu.is_del = #{isDel}</if>
		<if test="isRead != null" >and mu.is_read = #{isRead}</if>
		<if test="isSend != null" >and mu.is_send = #{isSend}</if>
		<if test="status != null" >and me.status = #{status}</if>
		</where>
	</select>

	<!-- 单条已读 -->
	<update id="updateToRead" parameterType="hashmap">
		update schedule_message_user 
		<set>
		<if test="isRead != null" >is_read = #{isRead},</if>
		<if test="updatedTime != null" >updated_time = #{updatedTime}</if>
		</set>
		where mid=#{mid};
	</update>
	
	
	<!-- 消息列表 -->
	<select id="selectMessageList" parameterType="hashmap"
		resultType="com.galaxy.im.bean.message.ScheduleMessageUserBean">
		select
		mu.id, mu.mid, mu.uid, mu.type_role typeRole, mu.is_read isRead,mu.is_use
		isUse,mu.is_send,
		me.type, me.remrk_id remrkId, me.content , me.send_time sendTime
		from
		schedule_message_user mu left join schedule_message me on mu.mid =
		me.id
		<where>
		<if test="userId != null" > mu.uid = #{userId}</if>
		<if test="isUse != null" >and mu.is_use = #{isUse}</if>
		<if test="isDel != null" >and mu.is_del = #{isDel}</if>
		<if test="isRead != null" >and mu.is_read = #{isRead}</if>
		<if test="isSend != null" >and mu.is_send = #{isSend}</if>
		<if test="status != null" >and me.status = #{status}</if>
		</where>
	</select>
	
	<!-- 全部设为已读 -->
	<update id="perMessageToRead" parameterType="hashmap">
		update schedule_message_user 
		<set>
		<if test="isRead != null" >is_read = #{isRead},</if>
		<if test="updatedTime != null" >updated_time = #{updatedTime}</if>
		</set>
		 <where>
			<trim prefixOverrides="and">
				<if test="ids != null">
					and mid IN
					<foreach collection="ids" index="atem" item="atem" open="(" separator="," close=")">
						#{atem}
					</foreach>
				</if> 
				<if test="userId != null" > and uid = #{userId}  </if>
			</trim>
		</where>
	</update>
	
	<!-- 全部清空-->
	<update id="perMessageToClear" parameterType="hashmap">
		update schedule_message_user 
		<set>
		<if test="isDel != null" >is_del = #{isDel},</if>
		<if test="updatedTime != null" >updated_time = #{updatedTime}</if>
		</set>
		<where>
			<trim prefixOverrides="and">
				<if test="ids != null">
					and mid IN
					<foreach collection="ids" index="atem" item="atem" open="(" separator="," close=")">
						#{atem}
					</foreach>
				</if> 
				<if test="userId != null" > and uid = #{userId}  </if>
			</trim>
		</where>
	</update>
	
	<!-- 批量保存消息信息 -->
	<insert id="saveMessageUser" useGeneratedKeys="true" parameterType="java.util.List">  
	    <selectKey resultType="long" keyProperty="id" order="AFTER">  
	        SELECT  
	        LAST_INSERT_ID()  
	    </selectKey>  
	    	insert into schedule_message_user 
	    	(id, mid, uid, uname, 
	        type_role, is_use, is_send, 
	        is_read, is_del, created_time, 
	        updated_time)
	        values
	    <foreach collection="list" item="item" index="index" separator="," >  
	       (#{item.id}, #{item.mid}, #{item.uid}, #{item.uname}, 
	        #{item.typeRole}, #{item.isUse}, #{item.isSend}, 
	        #{item.isRead}, #{item.isDel}, #{item.createdTime}, 
	        #{item.updatedTime})
	    </foreach> 
	</insert>
	
	<!-- 查询消息 -->
	<select id="selectMessageUserList" resultType="java.util.Map" parameterType="java.util.Map">
		select
			id, mid, uid, uname, type_role typeRole, is_use isUse, is_send isSend, 
			is_read isRead, is_del isDel, created_time createdTime, updated_time updatedTime
		from schedule_message
		<include refid="Base_Where_Clause" />
	</select>
</mapper>